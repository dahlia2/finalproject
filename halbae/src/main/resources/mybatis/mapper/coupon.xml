<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.gdu.halbae.mapper.CouponMapper">

    <!-- 쿠폰 결과를 매핑하기 위한 resultMap 설정 -->
    <resultMap id="couponResultMap" type="CouponDTO">
        <id column="COUPON_NO" property="couponNo" />
        <result column="COUPON_NAME" property="couponName" />
        <result column="COUPON_DISCOUNT" property="couponDiscount" />
        <result column="COUPON_STARTDATE" property="couponStartDate" />
        <result column="COUPON_ENDDATE" property="couponEndDate" />
    </resultMap>
    
    <!-- 모든 쿠폰 목록 조회 -->
    <select id="getAllCoupons" resultMap="couponResultMap">
        <!-- 쿠폰 테이블에서 모든 데이터를 조회 -->
        SELECT * 
          FROM COUPON
    </select>
    
    <!-- 회원의 보유 쿠폰 수 조회 -->
    <select id="getUserCouponCount" resultType="int">
        SELECT COUNT(*) 
          FROM COUPON_USER
         WHERE USER_NO = #{userNo}
    </select>
    
    <!-- 쿠폰 생성 -->
    <insert id="createCoupon">
        INSERT INTO COUPON (COUPON_NAME, COUPON_DISCOUNT, COUPON_STARTDATE, COUPON_ENDDATE)
        VALUES (#{couponName}, #{couponDiscount}, #{couponStartDate}, #{couponEndDate})
    </insert>
    
    <!-- 쿠폰 사용 -->
    <update id="useCoupon">
        UPDATE COUPON_USER
           SET COUPON_STATUS = #{couponStatus}
         WHERE USER_NO = #{userNo} 
           AND COUPON_NO = #{couponNo}
    </update>
    
</mapper>