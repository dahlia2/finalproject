<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.gdu.halbae.mapper.CouponMapper">
    
    <!-- 모든 쿠폰 목록 조회 -->
    <select id="getAllCoupons" resultType="CouponDTO">
        SELECT * 
          FROM COUPON
    </select>
    
    <!-- 회원의 보유 쿠폰 수 조회 -->
	<select id="getAvailableCouponCount" resultType="java.lang.Integer">
	    SELECT COUNT(*) 
	      FROM COUPON 
	     WHERE COUPON_START_DATE &lt;= #{currentDate} AND COUPON_END_DATE &gt;= #{currentDate}
	</select>

    <!-- 쿠폰 생성 -->
    <insert id="createCoupon">
        INSERT INTO COUPON (COUPON_NAME, COUPON_DISCOUNT, COUPON_STARTDATE, COUPON_ENDDATE)
        VALUES (#{couponName}, #{couponDiscount}, #{couponStartDate}, #{couponEndDate})
    </insert>
    
    <!-- 쿠폰 사용 -->
    <update id="useCoupon">
        UPDATE COUPON_USER
           SET COUPON_STATUS = #{couponStatus}
         WHERE USER_NO = #{userNo} 
           AND COUPON_NO = #{couponNo}
    </update>
    
</mapper>