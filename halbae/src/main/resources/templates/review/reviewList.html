<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>reviewList</title>
    <link rel="stylesheet" href="/css/reviewList.css" />
</head>

<script>

	function likeReview(reviewNo) {
	    // 좋아요 버튼 요소 가져오기
	    const buttonId = `likeButton_${reviewNo}`;
	    const likeButton = document.getElementById(buttonId);
	    // 이미 좋아요를 누른 경우 경고창 표시
	    if (likeButton.classList.contains('liked')) {
	        alert('이미 좋아요를 누르셨습니다.');
	        return;
	    }
	    // 서버로 좋아요 요청 전송
	    fetch(`/like/${reviewNo}`, {
	        method: 'POST',
	    })
	        .then(response => response.json())
	        .then(data => {
	            if (data.success) {
	                // 좋아요 버튼 텍스트 업데이트
	                likeButton.textContent = `Like (${data.likeCount})`;
	                // 좋아요 버튼 스타일 변경
	                likeButton.classList.add('liked');
	            }
	        })
	        .catch(error => {
	            console.error('Error:', error);
	        });
	}
    
</script>

<body>

	<!-- 리뷰 목록 -->
	<div id="review" class="tab-content">
	    <!-- 리뷰 별점의 평균 출력 -->
	    <p> 평점: <span th:text="${averageRating}"></span></p>
	    <div>
	    	<a th:href="@{/review/write}">리뷰 작성하기</a>
	    </div>
	    <ul id="reviewList">
	        <!-- 리뷰들을 리뷰 번호(REVIEW_NO) 내림차순으로 정렬 -->
	        <li th:each="review : ${reviewList}">
	            <div style="display: flex; justify-content: space-between; align-items: center;">
	                <!-- 회원의 프로필사진 -->
	                <div th:class="${review.userDTO.userH asImg == 1} ? 'profile-image' : 'profile-image no-image'">
	                    <img id="images1" th:if="${review.userDTO.userHasImg == 1}" th:src="${review.userDTO.userImgPath}" alt="Profile Image">
	                </div>
				<div class="rating">
	                <img th:each="i : ${#numbers.sequence(1, review.reviewGrade)}" th:src="@{'/images/review/star-filled.png'}" alt="Filled Star">
	                <img th:each="i : ${#numbers.sequence(review.reviewGrade + 1, 5)}" th:src="@{'/images/review/star-empty.png'}" alt="Empty Star">
	            </div>
	                <p style="margin-right: 10px;" th:text="${review.userDTO.userName}"></p>
	                <!-- 리뷰 작성 시간 -->
	                <p style="font-size: 12px;" th:text="${review.writeDate}"></p>
	            </div>
	            <p th:text="${review.reviewContent}"></p>
	            <!-- 리뷰 작성 시 첨부한 이미지들 출력 -->
	            <div>
	                <ul class="attachment-list">
	                    <li th:each="attach : ${review.reviewAttachList}">
	                        <img id="images2" th:if="${attach.thumbnail == 1}" th:src="${attach.path}" alt="Attachment Image">
	                        <span th:if="${attach.thumbnail == 0}"></span>
	                    </li>
	                </ul>
	            </div>
	            <!-- 좋아요 기능 -->
	            <div>
	               <button class="like-button" th:id="'likeButton_' + ${review.reviewNo}" th:text="'Like (' + ${review.likeCount} + ')'" th:attr="onclick='likeReview(' + ${review.reviewNo} + ')'"></button>
	            </div>
	        </li>
	    </ul>
	</div>

</body>
</html>