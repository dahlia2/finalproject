<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>쿠폰</title>
    <link rel="stylesheet" href="/css/coupon.css" />
</head>

<script th:inline="javascript">

	function issueCoupon() {
	    var couponName = document.getElementById("couponName").value;
	    // Ajax를 사용하여 서버에 쿠폰 정보를 전송
	    var xhr = new XMLHttpRequest();
	    xhr.open("POST", "/issueCoupon", true);
	    xhr.setRequestHeader("Content-Type", "application/json");
	    xhr.onreadystatechange = function () {
	        if (xhr.readyState === 4 && xhr.status === 200) {
	            // 응답을 받았을 때의 동작
	            var response = JSON.parse(xhr.responseText);
	            if (response === "success") {
	                alert("쿠폰이 발급되었습니다.");
	            } else {
	                alert("쿠폰 발급에 실패했습니다.");
	            }
	        }
	    };
	    var couponDTO = { couponName: couponName };
	    xhr.send(JSON.stringify(couponDTO));
	}
	
</script>

<body>

    <form id="container">
	    <div id="header">
	        <h3>내쿠폰</h3>
	    </div>
		<div id="coupon">
		    <input type="text" id="couponName" placeholder="&nbsp;&nbsp;&nbsp;쿠폰 코드를 입력해주세요.">
		    <input type="button" id="button" value="등록" onclick="issueCoupon()">
		</div>
		<div id="m">
			<p>사용 가능 쿠폰 <span id="count" style="color: red; font-weight: bold;" th:text="|${couponCount}장|"></span></p>
	    </div>
	    <div id="couponList">
	        <table>
	        	<tbody>
		            <tr th:each="coupon : ${coupons}">
		                <td th:text="|${coupon.couponName} 회원 웰컴 쿠폰|"></td>
		                <td>
						  <span th:text="|${coupon.couponDiscount}%|"></span>
						  <span style="color: black;">&nbsp;할인</span>
						</td>
						<td>
						  <span th:text="${#temporals.format(coupon.couponStartDate, 'yyyy-MM-dd')}"></span>
						  <span>&nbsp;~&nbsp;</span>
						  <span th:text="${#temporals.format(coupon.couponEndDate, 'yyyy-MM-dd')}"></span>
						</td>
		            </tr>
	        	</tbody>
	        </table>
	    </div>
	    <div id="info1">
	        <p>①&nbsp;쿠폰 사용 유의사항을 꼭 숙지해주세요!</p>
	    </div>
	    <div id="info2">
	        <p>- 쿠폰은 클래스 당 1장만 사용이 가능합니다.</p>
	        <p>- 보유 쿠폰은 유효기간 내에 사용이 가능하며 만료시 재발급은 불가합니다.</p>
	        <p>- 환불의 경우 결제 취소 및 환불 완료 시점에 유효 기간이 남아있는 경우에만</p>
	        <p>- 사용 가능 상태로 복구되며, 경우에 따라 쿠폰은 소멸될 수 있습니다.</p>
	        <p>- 부정한 방법으로 쿠폰이 발급된 경우 회수될 수 있습니다.</p>
	        <p>- 쿠폰 금액이 결제 금액을 초과하는 경우 차액은 반환되지 않습니다.</p>
	        <p>- 다른 계정으로 양도가 불가능합니다.</p>
	        <p>- 쿠폰의 제공 내용 및 운영 방침은 회사 정책에 따라 달라질 수 있습니다.</p>
	        <p>- 맞춤 결제(커스텀 결제) 시 쿠폰 사용이 제한됩니다.</p>
	    </div>
	</form>

</body>
</html>